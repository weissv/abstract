# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –£–ª—É—á—à–µ–Ω–∏—è

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –û—à–∏–±–∫–∏

### 1. ‚ùå `NameError: name 'np' is not defined`
**–ì–¥–µ:** `src/advanced_patching.py`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
import numpy as np  # –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç
```

### 2. ‚ùå –ó–∞–ø—Ä–æ—Å HF_TOKEN –≤–æ –≤—Ä–µ–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
**–ì–¥–µ:** –í—Å–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –∏ `src/model_utils.py`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- `get_hf_token()` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Google Colab secrets
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: Colab secrets ‚Üí ENV variables ‚Üí User input
- –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –±–æ–ª—å—à–µ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç —Ç–æ–∫–µ–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ

**–ö–æ–¥:**
```python
def get_hf_token() -> str:
    # 1. Check ENV
    token = os.environ.get("HF_TOKEN")
    if token:
        return token
    
    # 2. Check Google Colab userdata
    try:
        from google.colab import userdata
        token = userdata.get('HF_TOKEN')
        if token:
            print("‚úì Using token from Colab secrets")
            return token
    except:
        pass
    
    # 3. Fallback to input
    token = input("Enter HF token: ")
    return token
```

### 3. ‚ùå –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥ –≤ `experiments/02_patching.py`
**–ü—Ä–æ–±–ª–µ–º–∞:** 64 —Å—Ç—Ä–æ–∫–∏ –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º–æ–≥–æ –∫–æ–¥–∞ –ø–æ—Å–ª–µ `return`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª—ë–Ω –≤–µ—Å—å –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 307-370)

---

## –ù–æ–≤—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìä –ü–æ–ª–Ω–∞—è –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Colab

–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `src/colab_visualization.py` —Å 6 —Ç–∏–ø–∞–º–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤:

#### 1. **Causal Effects Heatmap** (`01_causal_heatmap.html`)
- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –ø–æ —Å–ª–æ—è–º –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
- –¶–≤–µ—Ç–∞: –∫—Ä–∞—Å–Ω—ã–π = –∏–Ω–¥—É—Ü–∏—Ä—É–µ—Ç –æ—Ç–∫–∞–∑, —Å–∏–Ω–∏–π = –∏–Ω–¥—É—Ü–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ
- –†–∞–∑–º–µ—Ä: 1200x400px

#### 2. **Layer Importance Bar Chart** (`02_layer_importance.html`)
- –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è
- –î–≤–µ –º–µ—Ç—Ä–∏–∫–∏: Max Effect (–∫—Ä–∞—Å–Ω—ã–π) –∏ Mean Effect (—Å–∏–Ω–∏–π)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∏–µ —Å–ª–æ–∏ –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã

#### 3. **Top Components Scatter** (`03_top_components.html`)
- Scatter plot —Ç–æ–ø-30 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- X-axis: Causal Effect, Y-axis: KL Divergence
- –†–∞–∑–º–µ—Ä —Ç–æ—á–∫–∏ = –≤–µ–ª–∏—á–∏–Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∞
- –°–∏–º–≤–æ–ª = –∏–Ω–¥—É—Ü–∏—Ä–æ–≤–∞–ª –ª–∏ –æ—Ç–∫–∞–∑

#### 4. **Refusal Cascade** (`04_refusal_cascade.html`)
- –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –ø–æ —Å–ª–æ—è–º
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è attention, MLP, residual
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–∫–∞—Å–∫–∞–¥ –æ—Ç–∫–∞–∑–∞" —á–µ—Ä–µ–∑ —Å–µ—Ç—å

#### 5. **Logit Stats Comparison** (`05_logit_stats.html`)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–≥–∏—Ç–æ–≤: Harmful vs Harmless vs Patched
- –î–≤–∞ –≥—Ä–∞—Ñ–∏–∫–∞: Logit Differences –∏ Probability Mass
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è —Å–∏–ª—å–Ω–µ–π—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

#### 6. **Ransomware Bypass Analysis** (`06_ransomware_bypass.html`)
- –ê–Ω–∞–ª–∏–∑ –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã ransomware-–ø—Ä–æ–º–ø—Ç–æ–º
- L2 distance –∞–∫—Ç–∏–≤–∞—Ü–∏–π –ø–æ —Å–ª–æ—è–º
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–¥–µ "—Å–ª–æ–º–∞–ª–∞—Å—å" –∑–∞—â–∏—Ç–∞

### üé® –§—É–Ω–∫—Ü–∏–∏ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

```python
from colab_visualization import (
    create_comprehensive_dashboard,
    display_in_colab,
    create_summary_table
)

# –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π
figures = create_comprehensive_dashboard(
    all_results=results,
    analysis=analysis,
    bypass_analysis=bypass_analysis,
    save_dir="outputs/figures"
)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Colab
display_in_colab(figures)

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–ø-20
summary_df = create_summary_table(analysis)
print(summary_df)
```

### üìã Summary Table (CSV)

–°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `outputs/results/02_top_components_summary.csv`:

| Rank | Layer | Component | Head | Causal Effect | KL Divergence | Induced Refusal |
|------|-------|-----------|------|---------------|---------------|-----------------|
| 1    | 18    | attention | N/A  | +12.4567      | 0.8923        | ‚úì               |
| 2    | 24    | mlp       | N/A  | +10.2341      | 0.7654        | ‚úì               |
| ...  | ...   | ...       | ...  | ...           | ...           | ...             |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –í—ã—Ö–æ–¥–Ω—ã—Ö –§–∞–π–ª–æ–≤

```
outputs/
‚îú‚îÄ‚îÄ results/
‚îÇ   ‚îú‚îÄ‚îÄ 02_patching_combined.json          # –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ 02_patching_pair_1.json            # –î–µ—Ç–∞–ª–∏ –ø–∞—Ä—ã 1
‚îÇ   ‚îú‚îÄ‚îÄ 02_patching_pair_2.json            # –î–µ—Ç–∞–ª–∏ –ø–∞—Ä—ã 2
‚îÇ   ‚îú‚îÄ‚îÄ 02_patching_pair_3.json            # –î–µ—Ç–∞–ª–∏ –ø–∞—Ä—ã 3
‚îÇ   ‚îú‚îÄ‚îÄ 02_top_components_summary.csv      # –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–ø-20
‚îÇ   ‚îî‚îÄ‚îÄ 02_ransomware_bypass_analysis.json # –ê–Ω–∞–ª–∏–∑ –æ–±—Ö–æ–¥–∞
‚îÇ
‚îî‚îÄ‚îÄ figures/
    ‚îú‚îÄ‚îÄ 01_causal_heatmap.html             # –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
    ‚îú‚îÄ‚îÄ 02_layer_importance.html           # –í–∞–∂–Ω–æ—Å—Ç—å —Å–ª–æ—ë–≤
    ‚îú‚îÄ‚îÄ 03_top_components.html             # –¢–æ–ø –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ 04_refusal_cascade.html            # –ö–∞—Å–∫–∞–¥ –æ—Ç–∫–∞–∑–∞
    ‚îú‚îÄ‚îÄ 05_logit_stats.html                # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–∏—Ç–æ–≤
    ‚îî‚îÄ‚îÄ 06_ransomware_bypass.html          # –ê–Ω–∞–ª–∏–∑ ransomware
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Google Colab

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–∫—Ä–µ—Ç–∞

```python
# –í Google Colab:
# 1. –ù–∞–∂–º–∏—Ç–µ –∑–Ω–∞—á–æ–∫ –∫–ª—é—á–∞ üîë –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
# 2. –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç —Å –∏–º–µ–Ω–µ–º 'HF_TOKEN'
# 3. –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à HuggingFace —Ç–æ–∫–µ–Ω
# 4. –í–∫–ª—é—á–∏—Ç–µ "Notebook access"
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

```bash
!python experiments/02_patching.py
```

### –®–∞–≥ 3: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è –≤ Colab
# –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ HTML —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é:
from google.colab import files
files.download('outputs/figures/01_causal_heatmap.html')
```

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
- ‚ùå –ó–∞–ø—Ä–∞—à–∏–≤–∞–ª —Ç–æ–∫–µ–Ω –∫–∞–∂–¥—ã–π —Ä–∞–∑
- ‚ùå –û–¥–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- ‚ùå –û—à–∏–±–∫–∞ —Å numpy
- ‚ùå –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ Colab secrets
- ‚úÖ 6 —Ç–∏–ø–æ–≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö visualizations
- ‚úÖ CSV —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –ß–∏—Å—Ç—ã–π –∫–æ–¥ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Colab
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤

---

## –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω–∞—è –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è.
–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É –Ω–∞ Google Colab T4 GPU.
